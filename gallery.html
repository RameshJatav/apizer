<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gallery with Images & Videos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #0f0f1b; color: #f0f0f0; font-family: sans-serif; }
    .fade-slide-up { opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
    .fade-slide-up.visible { opacity: 1; transform: translateY(0); }
    .thumb-video { overflow: hidden; }
    .thumb-video video { width: 100%; height: 100%; object-fit: cover; display: block; }
    #thumbnailList img { cursor: pointer; }
    #thumbnailList img.ring-2 { border: 2px solid cyan; }
    /* spinner */
    .spinner {
      border: 3px solid transparent;
      border-top-color: #4fd1c5;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <!-- Loading Spinner -->
  <div id="loadingSpinner" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 hidden">
    <div class="spinner"></div>
  </div>

  <h1 class="text-center text-3xl my-6 text-cyan-400">Gallery</h1>
  <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 px-4"></div>

  <!-- Modal -->
  <div id="mediaModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
    <div class="relative bg-gray-900 rounded-lg overflow-hidden max-w-3xl w-full">
      <button onclick="closeModal()" class="absolute top-2 right-2 text-white text-3xl">✕</button>
      <div class="p-4 flex flex-col items-center">
        <img id="modalImage" class="hidden max-h-[70vh] rounded" />
        <video id="modalVideo" class="hidden max-h-[70vh]" controls></video>
        <div class="mt-4 flex w-full justify-between">
          <button onclick="prevMedia()" class="text-white px-4 py-2">⟨ Prev</button>
          <button onclick="nextMedia()" class="text-white px-4 py-2">Next ⟩</button>
        </div>
      </div>
      <div id="thumbnailList" class="absolute bottom-2 left-2 right-2 flex space-x-2 overflow-x-auto bg-gray-800 p-2"></div>
    </div>
  </div>

  <script>
    let mediaList = [];
    let currentIndex = 0;

    const galleryEl = document.getElementById('gallery');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const modal = document.getElementById('mediaModal');
    const modalImage = document.getElementById('modalImage');
    const modalVideo = document.getElementById('modalVideo');
    const thumbnailList = document.getElementById('thumbnailList');

    async function loadMediaList() {
      loadingSpinner.classList.remove('hidden');
      try {
        const res = await fetch('media_list.json');
        mediaList = await res.json();
      } catch (e) {
        console.error('Failed to load manifest', e);
      }
      renderGallery();
      loadingSpinner.classList.add('hidden');
    }

    function renderGallery() {
      mediaList.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'fade-slide-up bg-gray-800 rounded-lg overflow-hidden cursor-pointer';
        div.onclick = () => openModal(idx);

        if (item.type === 'image') {
          const img = document.createElement('img');
          img.src = item.src;
          img.alt = '';
          img.className = 'w-full h-48 object-cover';
          div.appendChild(img);
        } else if (item.type === 'video') {
          const wrapper = document.createElement('div');
          wrapper.className = 'thumb-video w-full h-48 relative';
          const vid = document.createElement('video');
          vid.src = item.src;
          vid.muted = true;
          vid.loop = true;
          vid.playsInline = true;
          vid.className = 'w-full h-full object-cover';
          wrapper.appendChild(vid);
          wrapper.onmouseenter = () => { vid.play(); };
          wrapper.onmouseleave = () => { vid.pause(); vid.currentTime = 0; };
          div.appendChild(wrapper);
        }

        galleryEl.appendChild(div);
      });
    }

    function openModal(idx) {
      currentIndex = idx;
      updateModal();
      modal.classList.remove('hidden');
    }

    function closeModal() {
      modal.classList.add('hidden');
      modalVideo.pause();
    }

    function nextMedia() {
      currentIndex = (currentIndex + 1) % mediaList.length;
      updateModal();
    }

    function prevMedia() {
      currentIndex = (currentIndex - 1 + mediaList.length) % mediaList.length;
      updateModal();
    }

    function updateModal() {
      const item = mediaList[currentIndex];
      modalImage.classList.add('hidden');
      modalVideo.classList.add('hidden');

      if (item.type === 'image') {
        modalImage.src = item.src;
        modalImage.classList.remove('hidden');
      } else if (item.type === 'video') {
        modalVideo.src = item.src;
        modalVideo.classList.remove('hidden');
        modalVideo.play();
      }

      // thumbnails
      thumbnailList.innerHTML = '';
      mediaList.forEach((itm, i) => {
        const thumb = document.createElement('img');
        thumb.id = `thumb${i}`;
        thumb.className = 'h-16 object-cover rounded cursor-pointer';
        thumb.src = itm.type === 'image' ? itm.src : itm.src;
        thumb.onclick = () => openModal(i);
        if (i === currentIndex) {
          thumb.classList.add('ring-2', 'ring-cyan-400');
        }
        thumbnailList.appendChild(thumb);
      });
    }

    document.addEventListener('DOMContentLoaded', loadMediaList);
  </script>
</body>
</html>
